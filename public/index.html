<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة سفراء الجودة - TVTC</title>
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p>جاري التحميل...</p>
    </div>

    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="screen active">
        <div class="welcome-container">
            <div class="welcome-card">
                <div class="icon-badge">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h1 class="main-title">مبادرة سفراء الجودة</h1>
                <p class="subtitle">الكلية التقنية بحقل - وكالة ضبط الجودة</p>
                <p class="description">نرحب بك في منصة التسجيل والمتابعة</p>
                
                <div class="info-box">
                    <p>كن جزءاً من رحلة التميز والجودة. سجّل الآن وشارك في صناعة مستقبل أفضل للمنشأة ومجتمعك.</p>
                </div>

                <button onclick="startRegistration()" class="btn-primary btn-large">
                    ابدأ التسجيل
                    <i class="fas fa-arrow-left"></i>
                </button>

                <button onclick="showAdminLogin()" class="btn-secondary btn-small">
                    <i class="fas fa-shield-alt"></i>
                    دخول المشرف
                </button>
            </div>
        </div>
    </div>

    <!-- Registration Screen -->
    <div id="registrationScreen" class="screen">
        <div class="container">
            <!-- Progress Bar -->
            <div id="progressBar" class="progress-container">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <p class="progress-text"><span id="progressPercent">0</span>% مكتمل</p>
            </div>

            <!-- Registration Card -->
            <div class="registration-card">
                <!-- Step 1: Student ID -->
                <div id="step1" class="registration-step active">
                    <h2 class="step-title">الخطوة 1: الرقم التدريبي</h2>
                    <p class="step-description">أدخل رقمك التدريبي للمتابعة</p>

                    <div class="form-group">
                        <label for="studentId">الرقم التدريبي</label>
                        <input type="text" id="studentId" placeholder="مثال: 4461XXXXX" class="form-input">
                    </div>

                    <div id="errorMessage" class="error-message hidden">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="errorText"></span>
                    </div>

                    <button onclick="searchStudent()" class="btn-primary">
                        البحث والمتابعة
                    </button>

                    <div style="margin-top: 25px; padding: 16px; background: linear-gradient(135deg, #e8f5e9 0%, #f0f8ff 100%); border-right: 4px solid #00a49a; border-radius: 10px; text-align: center;">
                        <p style="margin: 0 0 12px 0; color: #1e3c72; font-size: 14px; font-weight: 600;">
                            ℹ️ المتدربين المسجلين فقط في مبادرة سفراء الجودة يسمح لهم الدخول
                        </p>
                        <p style="margin: 0; color: #666; font-size: 13px; line-height: 1.6;">
                            إذا لم تكن مسجلاً، يرجى التواصل مع وكيل ضبط الجودة بالكلية التقنية
                        </p>
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(0, 164, 154, 0.2);">
                            <a href="https://t.me/EngFahadSaleh" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; background: #00a49a; color: white; padding: 10px 18px; border-radius: 8px; text-decoration: none; font-size: 13px; font-weight: 700; transition: all 0.3s ease; cursor: pointer;">
                                <i class="fab fa-telegram" style="font-size: 16px;"></i>
                                تواصل عبر التليجرام
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Confirm Data + Telegram -->
                <div id="step2" class="registration-step">
                    <h2 class="step-title">الخطوة 2: تأكيد البيانات</h2>
                    <p class="step-description">تحقق من بياناتك وأضف حساب تليجرام</p>

                    <div class="data-display">
                        <div class="data-row">
                            <label>الاسم</label>
                            <p id="displayName"></p>
                        </div>
                        <div class="data-row">
                            <label>الرقم التدريبي</label>
                            <p id="displayId"></p>
                        </div>
                        <div class="data-row">
                            <label>القسم</label>
                            <p id="displayDepartment"></p>
                        </div>
                        <div class="data-row">
                            <label>التخصص</label>
                            <p id="displaySpecialization"></p>
                        </div>
                        <div class="data-row">
                            <label>المستوى التدريبي</label>
                            <p id="displayLevel"></p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="telegram">حساب تليجرام</label>
                        <input type="text" id="telegram" placeholder="@username" class="form-input" dir="ltr">
                    </div>

                    <div id="errorMessage2" class="error-message hidden">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="errorText2"></span>
                    </div>

                    <button onclick="submitRegistration()" class="btn-primary">
                        تسجيل
                    </button>
                </div>

                <!-- Step 3: Success -->
                <div id="step3" class="registration-step">
                    <div class="success-container">
                        <div class="success-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h2 class="success-title">✅ أنت الآن ضمن سفراء الجودة</h2>
                        <p class="success-subtitle">مرحباً بك <span id="successName"></span></p>
                        <p class="success-description">تم ربط حسابك بنجاح</p>

                        <div class="resources-section">
                            <h3>الموارد والمرافق</h3>
                            <button class="btn-resource" onclick="downloadFile('presentation')">
                                <i class="fas fa-download"></i>
                                تحميل عرض المبادرة (PDF)
                            </button>
                        </div>

                        <button onclick="viewTasks()" class="btn-primary btn-large">
                            عرض مهامي
                            <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="studentDashboard" class="screen">
        <div class="container">
            <!-- Header -->
            <div class="dashboard-header">
                <div class="header-content">
                    <div class="user-info">
                        <h1>مهامي</h1>
                        <p>مرحباً <span id="dashboardName"></span></p>
                        <p class="user-details">
                            <span id="dashboardDept"></span> - المستوى <span id="dashboardLevel"></span>
                        </p>
                    </div>
                    <div class="header-actions">
                        <button onclick="logout()" class="btn-secondary btn-small">
                            <i class="fas fa-sign-out-alt"></i>
                            تسجيل خروج
                        </button>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalTasks">0</h3>
                        <p>إجمالي المهام</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-check-double"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="completedTasks">0</h3>
                        <p>المهام المنجزة</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon yellow">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="pendingTasks">0</h3>
                        <p>بانتظار التقييم</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="remainingTasks">0</h3>
                        <p>المهام المتبقية</p>
                    </div>
                </div>
            </div>

            <!-- Tasks List -->
            <div class="tasks-section">
                <h2 class="section-title">
                    <i class="fas fa-list-check"></i>
                    المهام المخصصة لك
                </h2>
                <div id="tasksList" class="tasks-list">
                    <!-- Tasks will be loaded here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="screen">
        <div class="container">
            <div class="dashboard-header">
                <div class="header-content">
                    <div class="user-info">
                        <h1><i class="fas fa-shield-alt"></i> لوحة تحكم المشرف</h1>
                        <p>إدارة ومتابعة سفراء الجودة</p>
                    </div>
                    <button onclick="logout()" class="btn-secondary btn-small">
                        <i class="fas fa-sign-out-alt"></i>
                        تسجيل خروج
                    </button>
                </div>
            </div>

            <!-- Admin Tabs -->
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="showAdminTab('overview')">
                    <i class="fas fa-chart-line"></i>
                    نظرة عامة
                </button>
                <button class="tab-btn" onclick="showAdminTab('students')">
                    <i class="fas fa-users"></i>
                    المتدربين
                </button>
                <button class="tab-btn" onclick="showAdminTab('submissions')">
                    <i class="fas fa-file-upload"></i>
                    الشواهد المرفوعة
                </button>
            </div>

            <!-- Admin Content -->
            <div id="adminContent">
                <!-- Will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content upload-modal">
            <button class="modal-close" onclick="closeUploadModal()">×</button>

            <div class="modal-header">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>رفع شاهد لمهمة: <span id="modalTaskTitle">—</span></h3>
            </div>

            <div class="modal-body">
                <p class="upload-description">يمكنك رفع ملف مباشرة أو استخدام رابط خارجي. الملفات المقبولة: صور، PDF، مستندات وعروض.</p>

                <div class="upload-section">
                    <label class="field-label">
                        <i class="fas fa-file"></i>
                        اختر ملف الشاهد
                    </label>
                    <input
                        type="file"
                        id="evidenceFile"
                        accept="image/*,.pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx"
                        class="file-input" />
                </div>

                <div class="divider">
                    <span>أو</span>
                </div>

                <div class="upload-section">
                    <label class="field-label">
                        <i class="fas fa-link"></i>
                        الصق رابط الملف (اختياري)
                    </label>
                    <input
                        type="url"
                        id="fileUrl"
                        placeholder="https://example.com/file.pdf"
                        class="url-input" />
                </div>

                <div class="upload-tips">
                    <h4><i class="fas fa-lightbulb"></i> نصائح</h4>
                    <ul>
                        <li>حجم الملف الأقصى: 10 MB</li>
                        <li>الصيغ المدعومة: PDF، صور، مستندات</li>
                        <li>تأكد من أن الملف واضح وسهل القراءة</li>
                    </ul>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeUploadModal()">إلغاء</button>
                <button class="btn-primary" onclick="submitEvidence()">
                    <i class="fas fa-check-circle"></i>
                    رفع الشاهد
                </button>
            </div>
        </div>
    </div>


    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- ⚠️ مهم جداً: ترتيب تحميل الملفات -->
    <script src="config.js"></script>
    <script src="script.js"></script>
</body>
</html>
